<canvas id="ctx" width="500" height="500" style="border: 1px solid #000"></canvas>

<script type="text/javascript">
	var ctx  = document.getElementById('ctx').getContext('2d')

	//1. Modify Settings =
	ctx.font = '30px Arial';  //; font used
	// ctx.fillStyle = 'red';		// color of the text and forms
	// ctx.globalAlpha = 0.5;		// transparency 0: invisible ; 1: visible
	
	// 2. Draw something
	// ctx.fillText('Hello',50,50); //write text ... ctx.fillText('text', x, y)
	// ctx.fillRect(50,50,100,100); // draw rectangle .. ctx.fillRect(startX, startY, width, height)
	// ctx.clearRect(75,75,100,100); // clear canvas ... ctx.fillRect(startX, startY, width, height)

	const HEIGHT = 500;
	const WIDTH = 500;
	const DISTANCE_COLLIDING= 30;
	let timeWhenGameStarted = Date.now();

	var message = 'Bouncing';

	// player
	let player = {
		x: 50,
		spdX: 40,
		y: 30, 
		spdY: 5,
		name:'P',
		hp: 20
	}

	let enemyList = {}

	//FUNCTION DECLARATION
	getDistanceBetweenEntity = function (entity1, entity2) { // return distance (number)
		let vx=entity1.x -entity2.x;
		let vy = entity1.y - entity2.y;
		return Math.sqrt(vx*vx + vy*vy);
	}

	testCollisionEntity = function (entity1, entity2){ // return if colliding (true/false)
		let distance = getDistanceBetweenEntity(entity1,entity2);
		return distance < DISTANCE_COLLIDING; // return true neu distance nho hon 10
	}

	enemy = function (id, x, y, spdX, spdY) {
		let enemy = {
			x: x,
			spdX: spdX,
			y:y, 
			spdY: spdY,
			name: "E" ,
			id: id
		}

		enemyList[id] = enemy;
	}

	document.onmousemove = function (mouse){
		var mouseX = mouse.clientX;
		var mouseY = mouse.clientY;

		player.x = mouseX;
		player.y = mouseY;
	}

	
	updateEntity = function (something){
		updateEntityPosition(something);
		drawEntity(something);
	}

	updateEntityPosition = function(something){
		something.x += something.spdX;
		something.y += something.spdY;

		if(something.x < 0 || something.x > WIDTH) {
			something.spdX = -something.spdX;
		}

		if(something.y < 0 || something.y > HEIGHT) {
			something.spdY = -something.spdY
		}
	}

	drawEntity = function (something){
		ctx.fillText(something.name,something.x,something.y);
	}

	update = function (){
		ctx.clearRect(0,0,WIDTH,HEIGHT); // xoa het noi dung trong canvas truoc khi ve lai

		for(var enemyIndex in enemyList){
			// console.log(key);
			updateEntity(enemyList[enemyIndex]);

			var colliding = testCollisionEntity(player,enemyList[enemyIndex]);
			if(colliding){
				player.hp -= 1;
				if(player.hp <= 0) {
					let timeSurvived = Date.now() - timeWhenGameStarted;
					console.log(`you lost! You servived for ${timeSurvived} ms!`);
					timeWhenGameStarted = Date.now();
					player.hp = 10;
				}
			}
		}

		drawEntity(player);
		ctx.fillText(`${player.hp} hp `,0,30);
	}

	enemy('E1', 150, 350, 10, 15);
	enemy('E2', 250, 150, 30, 25);
	enemy('E3', 170, 150, 15, 32);
	
	setInterval(update, 80);
</script>